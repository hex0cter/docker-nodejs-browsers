language: node_js

services:
  - docker

node_js:
  - "10"
  - "11"
  - "12"
  - "13"
  - "14"

branches:
  only:
  - master

script:
  - node --version
  - export LATEST_NODEJS=$(curl -s nodejs.org/dist/latest/SHASUMS256.txt | grep node- | cut -d '-' -f2 | head -1)
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
  - docker build --pull --rm --build-arg NODEJS=$(node --version | sed 's/v//') --tag hex0cter/nodejs-browsers:$(node --version | sed 's/v//') .
  - docker push hex0cter/nodejs-browsers:$(node --version | sed 's/v//')
  - echo $LATEST_NODEJS
  - rm -f $HOME/.docker/config.json
